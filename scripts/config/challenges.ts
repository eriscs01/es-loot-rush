import { MinecraftItemTypes } from "@minecraft/vanilla-data";
import { ChallengeDefinition, ChallengeDifficulty, RawChallengeData } from "../types";
import { ItemStack } from "@minecraft/server";

function getItemLabel(typeId: MinecraftItemTypes, includeVariant = true): string | undefined {
  const itemStack = new ItemStack(typeId);
  if (includeVariant) return itemStack.nameTag;

  const id = typeId.replace("minecraft:", "");
  // Return just the base type
  if (id.includes("_wool")) return "Wool";
  if (id.includes("_planks")) return "Planks";
  if (id.includes("_log")) return "Log";
  if (id.includes("_concrete_powder")) return "Concrete";
  if (id.includes("_concrete")) return "Concrete";
  if (id.includes("_terracotta")) return "Terracotta";
}

// Builder function to create challenge definitions with computed names
function buildChallenge(raw: RawChallengeData, difficulty: ChallengeDifficulty): ChallengeDefinition {
  const includeVariant = raw.variant !== "any";
  return {
    ...raw,
    name: `${raw.count} ${getItemLabel(raw.item, includeVariant)}`,
    difficulty,
  };
}

// Raw challenge data organized by difficulty
const RAW_CHALLENGES: Record<string, RawChallengeData[]> = {
  easy: [
    {
      id: "stone_age_stockpile",
      title: "Stone Age Stockpile",
      item: MinecraftItemTypes.Cobblestone,
      count: 32,
      points: 10,
    },
    {
      id: "lumberjacks_load",
      title: "Lumberjack's Load",
      item: MinecraftItemTypes.OakLog,
      count: 16,
      points: 12,
      variant: "any",
    },
    {
      id: "farmers_bounty",
      title: "Farmer's Bounty",
      item: MinecraftItemTypes.Bread,
      count: 8,
      points: 15,
    },
    {
      id: "miners_first_strike",
      title: "Miner's First Strike",
      item: MinecraftItemTypes.Coal,
      count: 8,
      points: 12,
    },
    {
      id: "wool_gatherer",
      title: "Wool Gatherer",
      item: MinecraftItemTypes.WhiteWool,
      count: 8,
      points: 15,

      variant: "any",
    },
    {
      id: "hunters_feast",
      title: "Hunter's Feast",
      item: MinecraftItemTypes.CookedBeef,
      count: 8,
      points: 15,

      variant: "any",
    },
    {
      id: "iron_seeker",
      title: "Iron Seeker",
      item: MinecraftItemTypes.IronOre,
      count: 4,
      points: 18,
    },
    {
      id: "builders_cache",
      title: "Builder's Cache",
      item: MinecraftItemTypes.OakPlanks,
      count: 32,
      points: 10,

      variant: "any",
    },
    {
      id: "dirt_digger",
      title: "Dirt Digger",
      item: MinecraftItemTypes.Dirt,
      count: 32,
      points: 10,

      variant: "any",
    },
    {
      id: "clay_collector",
      title: "Clay Collector",
      item: MinecraftItemTypes.ClayBall,
      count: 8,
      points: 15,
    },
    {
      id: "sand_hauler",
      title: "Sand Hauler",
      item: MinecraftItemTypes.Sand,
      count: 16,
      points: 12,
    },
    {
      id: "flower_power",
      title: "Flower Power",
      item: MinecraftItemTypes.Poppy,
      count: 6,
      points: 18,

      variant: "any",
    },
    {
      id: "gravel_grab",
      title: "Gravel Grab",
      item: MinecraftItemTypes.Gravel,
      count: 16,
      points: 12,
    },
    {
      id: "bone_collector",
      title: "Bone Collector",
      item: MinecraftItemTypes.Bone,
      count: 4,
      points: 15,
    },
    {
      id: "string_theory",
      title: "String Theory",
      item: MinecraftItemTypes.String,
      count: 6,
      points: 18,
    },
    {
      id: "sugar_rush",
      title: "Sugar Rush",
      item: MinecraftItemTypes.SugarCane,
      count: 8,
      points: 12,
    },
    {
      id: "cactus_collector",
      title: "Cactus Collector",
      item: MinecraftItemTypes.Cactus,
      count: 4,
      points: 15,
    },
    {
      id: "mushroom_hunt",
      title: "Mushroom Hunt",
      item: MinecraftItemTypes.RedMushroom,
      count: 6,
      points: 12,

      variant: "any",
    },
    {
      id: "feather_collector",
      title: "Feather Collector",
      item: MinecraftItemTypes.Feather,
      count: 6,
      points: 15,
    },
    {
      id: "egg_basket",
      title: "Egg Basket",
      item: MinecraftItemTypes.Egg,
      count: 8,
      points: 12,
    },
    {
      id: "flint_finder",
      title: "Flint Finder",
      item: MinecraftItemTypes.Flint,
      count: 4,
      points: 15,
    },
    {
      id: "snowball_stockpile",
      title: "Snowball Stockpile",
      item: MinecraftItemTypes.Snowball,
      count: 16,
      points: 10,
    },
    {
      id: "apple_orchard",
      title: "Apple Orchard",
      item: MinecraftItemTypes.Apple,
      count: 4,
      points: 18,
    },
    {
      id: "stick_stack",
      title: "Stick Stack",
      item: MinecraftItemTypes.Stick,
      count: 32,
      points: 10,
    },
    {
      id: "torch_lighter",
      title: "Torch Lighter",
      item: MinecraftItemTypes.Torch,
      count: 16,
      points: 12,
    },
    {
      id: "charcoal_burner",
      title: "Charcoal Burner",
      item: MinecraftItemTypes.Charcoal,
      count: 8,
      points: 15,
    },
    {
      id: "kelp_harvest",
      title: "Kelp Harvest",
      item: MinecraftItemTypes.Kelp,
      count: 16,
      points: 15,
    },
    {
      id: "bamboo_gatherer",
      title: "Bamboo Gatherer",
      item: MinecraftItemTypes.Bamboo,
      count: 16,
      points: 12,
    },
    {
      id: "paper_maker",
      title: "Paper Maker",
      item: MinecraftItemTypes.Paper,
      count: 8,
      points: 15,
    },
    {
      id: "sapling_collector",
      title: "Sapling Collector",
      item: MinecraftItemTypes.OakSapling,
      count: 4,
      points: 12,

      variant: "any",
    },
    {
      id: "wheat_harvest",
      title: "Wheat Harvest",
      item: MinecraftItemTypes.Wheat,
      count: 16,
      points: 15,
    },
    {
      id: "potato_picker",
      title: "Potato Picker",
      item: MinecraftItemTypes.Potato,
      count: 8,
      points: 12,
    },
    {
      id: "carrot_collector",
      title: "Carrot Collector",
      item: MinecraftItemTypes.Carrot,
      count: 8,
      points: 12,
    },
    {
      id: "beetroot_gatherer",
      title: "Beetroot Gatherer",
      item: MinecraftItemTypes.Beetroot,
      count: 8,
      points: 15,
    },
    {
      id: "pumpkin_harvest",
      title: "Pumpkin Harvest",
      item: MinecraftItemTypes.Pumpkin,
      count: 2,
      points: 15,
    },
    {
      id: "melon_slice_stack",
      title: "Melon Slice Stack",
      item: MinecraftItemTypes.MelonSlice,
      count: 8,
      points: 12,
    },
    {
      id: "vine_climber",
      title: "Vine Climber",
      item: MinecraftItemTypes.Vine,
      count: 8,
      points: 15,
    },
    {
      id: "lily_pad_collector",
      title: "Lily Pad Collector",
      item: MinecraftItemTypes.Waterlily,
      count: 4,
      points: 12,
    },
    {
      id: "sweet_berries",
      title: "Sweet Berries",
      item: MinecraftItemTypes.SweetBerries,
      count: 8,
      points: 15,
    },
    {
      id: "glow_berries",
      title: "Glow Berries",
      item: MinecraftItemTypes.GlowBerries,
      count: 6,
      points: 18,
    },
    {
      id: "crafting_table_maker",
      title: "Crafting Table Maker",
      item: MinecraftItemTypes.CraftingTable,
      count: 2,
      points: 10,
    },
    {
      id: "chest_builder",
      title: "Chest Builder",
      item: MinecraftItemTypes.Chest,
      count: 2,
      points: 12,
    },
    {
      id: "fence_crafter",
      title: "Fence Crafter",
      item: MinecraftItemTypes.OakFence,
      count: 16,
      points: 12,

      variant: "any",
    },
    {
      id: "door_maker",
      title: "Door Maker",
      item: MinecraftItemTypes.AcaciaDoor,
      count: 3,
      points: 10,

      variant: "any",
    },
  ],
  medium: [
    {
      id: "creepers_gift",
      title: "Creeper's Gift",
      item: MinecraftItemTypes.Gunpowder,
      count: 4,
      points: 35,
    },
    {
      id: "endermans_pearls",
      title: "Enderman's Pearls",
      item: MinecraftItemTypes.EnderPearl,
      count: 3,
      points: 40,
    },
    {
      id: "spiders_silk",
      title: "Spider's Silk",
      item: MinecraftItemTypes.SpiderEye,
      count: 4,
      points: 30,
    },
    {
      id: "iron_forged",
      title: "Iron Forged",
      item: MinecraftItemTypes.IronBlock,
      count: 2,
      points: 32,
    },
    {
      id: "diamond_toolsmith",
      title: "Diamond Toolsmith",
      item: MinecraftItemTypes.DiamondPickaxe,
      count: 1,
      points: 40,
    },
    {
      id: "librarians_pride",
      title: "Librarian's Pride",
      item: MinecraftItemTypes.Bookshelf,
      count: 4,
      points: 35,
    },
    {
      id: "redstone_engineer",
      title: "Redstone Engineer",
      item: MinecraftItemTypes.Redstone,
      count: 16,
      points: 30,
    },
    {
      id: "golden_ingots",
      title: "Golden Ingots",
      item: MinecraftItemTypes.GoldIngot,
      count: 2,
      points: 38,
    },
    {
      id: "slime_hunter",
      title: "Slime Hunter",
      item: MinecraftItemTypes.SlimeBall,
      count: 2,
      points: 42,
    },
    {
      id: "enchanters_start",
      title: "Enchanter's Start",
      item: MinecraftItemTypes.EnchantingTable,
      count: 1,
      points: 45,
    },
    {
      id: "treasure_map",
      title: "Treasure Map",
      item: MinecraftItemTypes.FilledMap,
      count: 1,
      points: 40,
    },
    {
      id: "melon_merchant",
      title: "Melon Merchant",
      item: MinecraftItemTypes.MelonBlock,
      count: 8,
      points: 28,
    },
    {
      id: "pumpkin_patch",
      title: "Pumpkin Patch",
      item: MinecraftItemTypes.CarvedPumpkin,
      count: 4,
      points: 30,
    },
    {
      id: "leather_worker",
      title: "Leather Worker",
      item: MinecraftItemTypes.Leather,
      count: 4,
      points: 32,
    },
    {
      id: "phantom_membrane",
      title: "Phantom Membrane",
      item: MinecraftItemTypes.PhantomMembrane,
      count: 1,
      points: 45,
    },
    {
      id: "cocoa_farmer",
      title: "Cocoa Farmer",
      item: MinecraftItemTypes.CocoaBeans,
      count: 8,
      points: 35,
    },
    {
      id: "ink_sac_collector",
      title: "Ink Sac Collector",
      item: MinecraftItemTypes.InkSac,
      count: 4,
      points: 30,
    },
    {
      id: "lapis_miner",
      title: "Lapis Miner",
      item: MinecraftItemTypes.LapisLazuli,
      count: 8,
      points: 32,
    },
    {
      id: "dye_collection",
      title: "Dye Collection",
      item: MinecraftItemTypes.RedDye,
      count: 6,
      points: 35,

      variant: "any",
    },
    {
      id: "obsidian_harvest",
      title: "Obsidian Harvest",
      item: MinecraftItemTypes.Obsidian,
      count: 3,
      points: 42,
    },
    {
      id: "arrow_crafter",
      title: "Arrow Crafter",
      item: MinecraftItemTypes.Arrow,
      count: 16,
      points: 30,
    },
    {
      id: "prismarine_collector",
      title: "Prismarine Collector",
      item: MinecraftItemTypes.PrismarineShard,
      count: 8,
      points: 38,
    },
    {
      id: "rabbit_foot",
      title: "Rabbit Foot",
      item: MinecraftItemTypes.RabbitFoot,
      count: 1,
      points: 40,
    },
    {
      id: "brick_maker",
      title: "Brick Maker",
      item: MinecraftItemTypes.Brick,
      count: 16,
      points: 28,
    },
    {
      id: "sugar_producer",
      title: "Sugar Producer",
      item: MinecraftItemTypes.Sugar,
      count: 16,
      points: 28,
    },
    {
      id: "bowl_crafter",
      title: "Bowl Crafter",
      item: MinecraftItemTypes.Bowl,
      count: 6,
      points: 30,
    },
    {
      id: "glass_maker",
      title: "Glass Maker",
      item: MinecraftItemTypes.Glass,
      count: 16,
      points: 30,
    },
    {
      id: "dried_kelp_producer",
      title: "Dried Kelp Producer",
      item: MinecraftItemTypes.DriedKelp,
      count: 16,
      points: 32,
    },
    {
      id: "honey_collector",
      title: "Honey Collector",
      item: MinecraftItemTypes.HoneyBottle,
      count: 2,
      points: 35,
    },
    {
      id: "honeycomb_gatherer",
      title: "Honeycomb Gatherer",
      item: MinecraftItemTypes.Honeycomb,
      count: 3,
      points: 35,
    },
  ],
  hard: [
    {
      id: "enchanted_knowledge",
      title: "Enchanted Knowledge",
      item: MinecraftItemTypes.EnchantedBook,
      count: 1,
      points: 55,
    },
    {
      id: "golden_delicacy",
      title: "Golden Delicacy",
      item: MinecraftItemTypes.GoldenApple,
      count: 1,
      points: 60,
    },
    {
      id: "village_vault",
      title: "Village Vault",
      item: MinecraftItemTypes.Emerald,
      count: 8,
      points: 65,
    },
    {
      id: "mob_tamer",
      title: "Mob Tamer",
      item: MinecraftItemTypes.NameTag,
      count: 1,
      points: 70,
    },
    {
      id: "music_disc_hunter",
      title: "Music Disc Hunter",
      item: MinecraftItemTypes.MusicDiscCat,
      count: 1,
      points: 65,

      variant: "any",
    },
    {
      id: "diamond_fortune",
      title: "Diamond Fortune",
      item: MinecraftItemTypes.Diamond,
      count: 3,
      points: 60,
    },
    {
      id: "totem_raid",
      title: "Totem Raid",
      item: MinecraftItemTypes.TotemOfUndying,
      count: 1,
      points: 75,
    },
    {
      id: "horse_trader",
      title: "Horse Trader",
      item: MinecraftItemTypes.Saddle,
      count: 1,
      points: 55,
    },
    {
      id: "oceans_heart",
      title: "Ocean's Heart",
      item: MinecraftItemTypes.HeartOfTheSea,
      count: 1,
      points: 70,
    },
    {
      id: "trident_bearer",
      title: "Trident Bearer",
      item: MinecraftItemTypes.Trident,
      count: 1,
      points: 75,
    },
    {
      id: "bell_ringer",
      title: "Bell Ringer",
      item: MinecraftItemTypes.Bell,
      count: 1,
      points: 50,
    },
    {
      id: "nautilus_shell",
      title: "Nautilus Shell",
      item: MinecraftItemTypes.NautilusShell,
      count: 1,
      points: 60,
    },
  ],
};

// Build the final CHALLENGES object with computed names
export const CHALLENGES: Record<string, ChallengeDefinition[]> = {
  easy: RAW_CHALLENGES.easy.map((c) => buildChallenge(c, "easy")),
  medium: RAW_CHALLENGES.medium.map((c) => buildChallenge(c, "medium")),
  hard: RAW_CHALLENGES.hard.map((c) => buildChallenge(c, "hard")),
};
